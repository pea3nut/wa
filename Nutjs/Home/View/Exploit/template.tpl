<extend name="__INCLUDE__/document.extend.tpl" />

<block name="title">模板开发文档</block>

<block name="h1">Web开发协会网站模板开发文档</block>

<block name="h1_text">
    <p>协会网站采用ThinkPHP3.2.3框架搭建而成，在页面显示（View层）方面使用使用ThinkPHP原生的ThinkTemplate模板引擎。</p>
    <p>详细的模板引擎使用请参考<a href="http://www.kancloud.cn/manual/thinkphp">ThinkPHP官方手册</a>中视图和模板章节，这里就不再过多赘述。本章节主要向开发者介绍协会网站的View层构架和模板开发。</p>
</block>

<block name="body">
<h2>模板构架</h2>
<p>协会的模板存放路径为</p>
<pre>
./Nutjs/View/控制器名/方法名.tpl
</pre>
<p>如协会的登陆页面“http://www.nutjs.com/Member/sign_in”，其中控制器名是Member，方法名是sign_in。所以调用的模板就为</p>
<pre>
http://www.nutjs.com/Nutjs/View/Member/sign_in.tpl
</pre>
<blockquote>
注意，路径是严格区分大小写的
</blockquote>
<p>我们为开发者提供了一个开发测试用的控制器 —— Mnt控制器。在进行模板开发时，无需知道控制器所在的位置，仅仅在“./Nutjs/View/”中新建一个以控制器命名的文件夹，如Mnt文件夹，然后自由的命名模板文件即可渲染执行。</p>
<p>建立以控制器命名的文件夹时，请确认存在此控制器。请使用Mnt控制器进行开发调试。</p>
<p>建立模板文件时，尽量让控制器名+模板名构成页面的语义，模板命名尽量采用一个单词的方式，如一个单词无法构成语义可用下划线+小写单词。</p>
<p>比如，我们在./Nutjs/View/建立一个Mnt文件夹，在里面建立一个test.tpl文件如下：</p>
<pre>
//文件路径./Nutjs/View/Mnt/test.tpl
Hello World!
</pre>
<p>我们通过URL[站点URL]/Mnt/test就可以看到如下显示：</p>
<pre>
Hello World!
</pre>
<p>通过“URL/控制/方法”即可访问渲染输出特定的模板文件，通过这个方法我们可以逆向推出绝大部分协会内网的页面模板的真实路径。</p>
<h2>资源文件</h2>
<p>不同页面的模板拥有不同的模板资源存放文件夹。其真实路径为：</p>
<pre>
//针对模板的资源文件夹
CSS文件:  ./Nutjs/Public/Style/控制器名/
JS文件:   ./Nutjs/Public/Script/控制器名/
图片文件:  ./Nutjs/Public/Image/控制器名/
引用文件:  ./Nutjs/Public/Include/控制器名/

//公共资源文件夹
./Public/
</pre>
<p>模板资源文件夹可以自由建立自由存放资源文件，通常来说意味着本控制器的模板无法使用其他控制器的资源文件。而公共资源文件夹中的资源文件可以让所有控制器访问使用。具体使用方法参考下一节“魔法常量”。</p>
<p>建立资源文件夹过程中，除Nutjs团队成员外不建议修改./Public/Libray/文件夹内的内容，如需使用公告资源文件夹，可以建立以自己名字全拼“骆驼峰+首字母大写”的文件夹来跨控制器使用资源。</p>
<p>如下面目录结构，我们建立了一个王尼玛的个人公共资源文件夹和一个Mnt控制器资源文件夹</p>
<pre>
站点目录
├─Nutjs 应用目录
│  ├─Home 站点模块
│  │  ├─Controller 控制器目录
│  │  ├─View 视图层目录(模板文件)
│  │  ├─Public 模板资源文件目录
│  │  │  ├─Mnt 测试控制器资源目录
│  │  │  └─... 其他控制器资源目录
│  │  └─... 其他目录
│  └─Runtime 运行时目录(缓存)
├─Public 公共资源文件目录
│  ├─WangNiMa 王尼玛的公共资源文件夹
│  └─Library Nutjs团队公共资源文件夹
├─ThinkPHP 框架目录
└─index.php 入口文件
</pre>
<h2>魔法常量</h2>
<p>除ThinkPHP系统提供的魔法常量外，我们还扩展了一些魔法常量来方便使用上面的目录结构。</p>
<p>在模板中，下面的魔法常量分别指向的目录为：</p>
<pre>
<php>echo '__PUB','__';</php>     =>  页面URL(不含域名)/Nutjs/Home/Public/
<php>echo '__STYLE','__';</php>   =>  页面URL(不含域名)/Nutjs/Home/Public/Style/控制器名
<php>echo '__IMAGE','__';</php>   =>  页面URL(不含域名)/Nutjs/Home/Public/Image/控制器名
<php>echo '__SCRIPT','__';</php>  =>  页面URL(不含域名)/Nutjs/Home/Public/Script/控制器名
<php>echo '__INCLUDE','__';</php> =>  ./Home/Public/Include/控制器名
</pre>
<p>如我们将站点存放在“/ThinkPHP/web_association/”中，并在Mnt控制器建立test模板（./Nutjs/Home/View/Mnt/test.tpl）</p>
<pre>
<php>echo '__PUB','__';</php>

<php>echo '__STYLE','__';</php>

<php>echo '__IMAGE','__';</php>

<php>echo '__SCRIPT','__';</php>

<php>echo '__INCLUDE','__';</php>

</pre>
<p>经过渲染后的结果为</p>
<pre>
/ThinkPHP/web_association/Nutjs/HomePublic/
/ThinkPHP/web_association/Nutjs/Home/Public/Style/Mnt
/ThinkPHP/web_association/Nutjs/Home/Public/Image/Mnt
/ThinkPHP/web_association/Nutjs/Home/Public/Script/Mnt
./Nutjs/Home/Public/Include/Mnt
</pre>
<p>通过这几个魔法常量，我们可以快捷的引用本控制器的资源文件，通常来说不建议使用<php>echo '__PUB','__';</php>常量来跨控制器访问资源文件，请使用公共资源文件夹。</p>
<pre>
&lt;include file=&quot;<php>echo '__INCLUDE','__';</php>/head.tpl&quot; /&gt;
    &lt;title&gt;开发中心&lt;/title&gt;
    &lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;<php>echo '__STYLE','__';</php>/h1.css&quot; /&gt;
    &lt;script charset=&quot;utf-8&quot; src=&quot;<php>echo '__PUBLIC','__';</php>/Library/Script/nut.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;欢迎你，开发者&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
<h2>与原生ThinkPHP不兼容</h2>
<p>由于某些原因，我们修改了ThinkPHP的核心源码，可能会带来与原生ThinkPHP不兼容的情况发生，请开发者在调试过程中测试指正，我们会第一时间修复不兼容现象。</p>
<pre>
联系人：花生PeA
邮箱：626954412@qq.com
</pre>
</block>