# Git分支使用情景 #

什么时候要建立分支，什么是Git的分支驱动。本章节会举一个详细的例子来形象的说明Git分支使用的情景。

> 注意，本节不考虑分支是否干净，仅仅是讲解分支使用情景。如何整理分支会在后面的章节讲解

## Git的分支 ##

Git鼓励使用分支来解决问题，也鼓励多次提交，所以当我们要给某个项目开发一个新功能时，可以新建一个以功能命名的分支，在功能分支上不断的进行提交，最终合并进主分支。同样，我们发现一个bug，也应该建立一个修复bug的分支，在分支上不断提交，最终合并进主分支。

这样做的好处是，一旦你这个功能开发到一半，突然要开发另一个功能，那么利用Git，你可以直接切换到主分支，再新建一个功能分支。2个功能分支互不干预，当完成功能时都会合并进主分支。

## Git分支应用举例 ##

举个例子：我们要开发协会网站的坚果商店功能。

首先我先要将源码clone到本地，然后在最新的一次提交（commit）上建立一个名字叫做“shop”的功能分支，用来开发商店功能。

那么，克隆下来分支可能是这个样子的

    * 7c2bb87 - (HEAD -> master)增加开发文档说明
    |
    * eff7c11 - 整理目录结构
    |
    * 1c70c4b - 完成了会员登录功能
    |
    * e5e896b - 创建项目

那么在默认的HEAD位置，新建了一个新分支，名字叫做shop，那么结构就应该是这样：

    * 7c2bb87 - (HEAD -> master, shop)增加开发文档说明
    |
    * eff7c11 - 整理目录结构
    |
    * 1c70c4b - 完成了会员登录功能
    |
    * e5e896b - 创建项目

那么你现在切换到shop分支上进行工作。

一段时间后，完成了商店首页后，你进行了一次提交

    * 870b6a8 - (HEAD -> shop)完成了商店首页
    |
    * 7c2bb87 - (master)增加开发文档说明
    |
    * eff7c11 - 整理目录结构
    |
    * 1c70c4b - 完成了会员登录功能
    |
    * e5e896b - 创建项目

由于这个商店功能是你自己单独开发的，没有必要让别人看到你的工作进度，或者是你完成了商店首页部分改动了某些项目核心配置，如果提交进Master分支上会干扰其他人的进度，所以你没有推送（push）要远程仓库。

但是第二天工作之前，你惯例的将master分支从远程拉下来时（pull），你发现另一位开发团队的成员完成了用户修改密码的功能，并且已经将他推送到服务器了。那么，当你从远程服务器把master分支拉下来的时候，你的本地分支变成了这样

      * 870b6a8 - (HEAD -> shop) 完成了商店首页
      |
    * / cba5826 - (master) 完成了修改密码部分
    |/
    * 7c2bb87 - 增加开发文档说明
    |
    * eff7c11 - 整理目录结构
    |
    * 1c70c4b - 完成了会员登录功能
    |
    * e5e896b - 创建项目

这时候你有2种选择：

- 将master分支合并进你的shop分支
- 不管他，继续在shop分支上开发你的商店功能

而实际上，用户修改密码功能并不影响你开发商店功能对不对？他们2个是完全独立的模块，所以我们这里就没有必要进行合并了，直接继续在shop开发即可，等我们把所有的功能开发完毕，再和master分支合并，这样如果有冲突也只是冲突一次。

所以，这里得出一个结论**开发新功能过程中采用分支开发可以避免冲突**

情况有变

项目负责人给你打了个电话，问你完成没完成用户修改资料的功能，网站马上就要上线了。你猛然想起来好像前几天睡懒觉的时候项目负责人告诉过你这件事，自己当时迷迷糊糊的答应了，醒来后就抛到脑后了......

OK，还好时间来得及，你搪塞了项目负责人几句（嘛，快完成了，还有一点点小Bug），马上切换到了master分支上，建立了一个change_inf分支来开发用户修改资料功能。

这时候你的Git分支结构应该是这样的

      * 870b6a8 - (shop) 完成了商店首页
      |
    * / cba5826 - (HEAD -> master ,change_inf) 完成了修改密码部分
    |/
    * 7c2bb87 - 增加开发文档说明
    |
    * eff7c11 - 整理目录结构
    |
    * 1c70c4b - 完成了会员登录功能
    |
    * e5e896b - 创建项目

然后不断的在change_inf分支上提交工作。

> 注意，870b6a8 节点只在shop分支上。一个 * 才表示一个提交

        * 4b8ad32 - (HEAD -> change_inf) 修正Bug
        |
        * bd1a340 - 写完了用户修改资料的后台
        |
        * c7d31a2 - 写完了用户修改资料的页面
        |
      * / 870b6a8 - (shop) 完成了商店首页
      |/
     /|
    * / cba5826 - (master) 完成了修改密码部分
    |/
    * 7c2bb87 - 增加开发文档说明
    |
    * eff7c11 - 整理目录结构
    |
    * 1c70c4b - 完成了会员登录功能
    |
    * e5e896b - 创建项目

大功告成！完成工作后你切换到master分支，将change_inf分支合并到主分支，在例子中我们使用下面个这个命令

    git merge --no-ff change_inf

合并后结构会是这样的

    * 66ba358 - (master) 完成了用户修改资料功能
    |\
    | \
    |  \
    |   * 4b8ad32 - (change_inf) 修正Bug
    |   |
    |   * bd1a340 - 写完了用户修改资料的后台
    |   |
    |   * c7d31a2 - 写完了用户修改资料的页面
    |   |
    | * / 870b6a8 - (shop) 完成了商店首页
    | |/
    |/|
    * / cba5826 - 完成了修改密码部分
    |/
    * 7c2bb87 - 增加开发文档说明
    |
    * eff7c11 - 整理目录结构
    |
    * 1c70c4b - 完成了会员登录功能
    |
    * e5e896b - 创建项目

看着稳定的代码跑在服务器上，你常舒了一口气，稍作休息后，你切换到shop分支，继续去开发你的商店功能。

所以说**Git是分支驱动的**。

## 总结 ##

每当有一个新需求时，就建立一个分支去解决他，这个需求可能是一个新功能，也可能是一个Bug的修复，也可能是其他的什么东西。当项目十分庞大需要多个人协作是，一个功能分支上可能再去细分很多个功能分支。

读者在看懂例子的情况下可以倒过头会看看本节开头的内容，是不是清晰多了？